do ->
  # $resourceをインジェクション
  app = angular.module('MyRoutesApp', ['ngResource'])

  # Rails CSRFトークンを使用するように設定
  app.config ["$httpProvider", ($httpProvider) ->
    $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content');
    $httpProvider.defaults.headers.common['X-Requested-With'] = "XMLHttpRequest"
  ]

  # Routeテーブルに対するRESTfullのマッパーを定義
  app.factory('Routes', ['$resource', ($resource) ->
    $resource('<%= asset_path("/routes/:id.json") %>', {id: '@id'})
  ])

  # コントローラその壱
  app.controller('AppController', ['$scope', 'Routes', ($scope, Routes) ->
    $scope.routes = Routes.query()
  ])